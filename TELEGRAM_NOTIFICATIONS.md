# 📱 Система уведомлений в Telegram

## 🎯 Обзор

Система автоматически отправляет уведомления в Telegram при различных действиях пользователей на сайте Any-Home.ru.

## 📊 Типы уведомлений

### 1. 📱 Переход в WhatsApp
- **Триггер**: Клик по любой ссылке WhatsApp (`wa.me` или `whatsapp`)
- **Содержание**: 
  - Источник трафика (UTM, referrer)
  - Информация о пользователе (устройство, разрешение, время на сайте)
  - Рекомендация оперативно ответить

### 2. 📞 Клик по телефону
- **Триггер**: Клик по любой ссылке `tel:`
- **Содержание**:
  - Номер телефона
  - Источник трафика
  - Информация о пользователе
  - Рекомендация быть готовым к звонку

### 3. 🎯 Клик по CTA "Получить расчет"
- **Триггер**: Клик по любой кнопке с `href="#project"`
- **Содержание**:
  - Источник трафика
  - Информация о пользователе
  - Рекомендация о высоком потенциале конверсии

### 4. 📝 Отправка форм
- **Главная форма расчета**: Полная информация о заявке
- **Форма каталога**: Информация о запросе каталога
- **Форма консультации**: Информация о запросе консультации

## 🔧 Техническая реализация

### Конфигурация
```javascript
const BOT_TOKEN = '8272787786:AAHhdBCZvk1B30ZaVvWIttRWBGuwF64gdaI';
const CHAT_ID = '-4979391524';
```

### Функция отправки
```javascript
function sendToTelegram(message) {
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            chat_id: CHAT_ID,
            text: message,
            parse_mode: 'HTML'
        })
    })
    // ... обработка ответа
}
```

### Отслеживание трафика
Функция `getTrafficInfo()` собирает:
- UTM параметры
- Яндекс.Директ и Google Ads ID
- Информацию об устройстве
- Разрешение экрана
- Время на сайте
- Язык браузера

## 📈 Интеграция с Яндекс.Метрикой

Все уведомления также отправляют события в Яндекс.Метрику:
- `whatsapp_click` - переход в WhatsApp
- `phone_click` - клик по телефону  
- `cta_get_quote_click` - клик по CTA
- `main_form_submit` - отправка главной формы
- `catalog_form_submit` - отправка формы каталога
- `consultation_form_submit` - отправка формы консультации

## 🎨 Форматирование сообщений

Сообщения используют:
- **HTML разметку** для форматирования
- **Эмодзи** для визуального разделения
- **Структурированные блоки** с разделителями
- **Рекомендации** для быстрого реагирования

## 🚀 Преимущества

1. **Мгновенные уведомления** о горячих лидах
2. **Полная аналитика** источника трафика
3. **Контекстная информация** о пользователе
4. **Рекомендации по действиям** для менеджеров
5. **Интеграция с аналитикой** через Яндекс.Метрику

## 📱 Примеры уведомлений

### WhatsApp переход:
```
📱 ПЕРЕХОД В WHATSAPP
━━━━━━━━━━━━━━━━━━━━
📊 ИСТОЧНИК ТРАФИКА
━━━━━━━━━━━━━━━━━━━━
🔗 Referrer: google.com
🎯 UTM Source: google
📢 UTM Medium: cpc
━━━━━━━━━━━━━━━━━━━━
💡 РЕКОМЕНДАЦИЯ
━━━━━━━━━━━━━━━━━━━━
Пользователь проявил интерес и перешел в WhatsApp. 
Рекомендуется оперативно ответить на сообщение!
```

### Клик по телефону:
```
📞 КЛИК ПО ТЕЛЕФОНУ
━━━━━━━━━━━━━━━━━━━━
📞 НОМЕР ТЕЛЕФОНА
━━━━━━━━━━━━━━━━━━━━
+7 (495) 120-35-42
━━━━━━━━━━━━━━━━━━━━
💡 РЕКОМЕНДАЦИЯ
━━━━━━━━━━━━━━━━━━━━
Пользователь готов звонить! Будьте готовы к звонку.
```

## 🔒 Безопасность

- Токен бота хранится в коде (для публичного сайта это нормально)
- ID чата скрыт от пользователей
- Все данные передаются через HTTPS
- Нет сохранения персональных данных на сервере

## 📊 Мониторинг

Для проверки работы системы:
1. Откройте сайт в браузере
2. Кликните по любой кнопке WhatsApp или телефону
3. Проверьте получение уведомления в Telegram
4. Проверьте события в Яндекс.Метрике

## 🛠️ Настройка

Для изменения настроек:
1. Обновите `BOT_TOKEN` и `CHAT_ID` в коде
2. Измените текст уведомлений по необходимости
3. Добавьте новые типы событий при необходимости

---

**Дата создания**: 17 октября 2025  
**Версия**: 1.0  
**Статус**: Активна ✅
